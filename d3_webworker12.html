<!--REMOVED SET TIME OUT -->

<button onclick='clicked();console.log(test123);test123.console.log("i");test123.postMessage("Message Sent","*");'>Test</button>

<script>

var test123 = {};
var clicked = function () {

function openAndPush() {
    var win = window.open();
    
    win.test = function () {
        win.console.log("Starting magic...");
        var oScript = win.document.createElement("script");
    
        
        var js = `window.addEventListener("message", function(event) {
        
            console.log( "received: " + event.data+" FROM:"+event.origin+" SOURCE:"+event.source );
            console.log(event);
            event.source.postMessage('New Tab responds back!!!',"*");

});
            `;

        oScript.id="tested";
        var oScriptText = win.document.createTextNode(js);
        oScript.appendChild(oScriptText);

        win.document.body.appendChild(oScript);
        win.console.log('New script appended!');
        
  

    }
    win.test();
    win.console.log('Tadaaaa!!!');
    test123 = win;

} 

openAndPush();

}



</script>


<p>Count numbers: <output id="result"></output></p>
<button onclick="startWorker()">Start Worker</button> 
<button onclick="stopWorker()">Stop Worker</button>



<script>

function startWorker(){
test123.postMessage("Message going and going","*");

window.addEventListener("message", function(event) {
  console.log(event);
console.log( "received: " + event.data+" FROM:"+event.origin+" SOURCE:"+event.source );
//event.source.postMessage('Source fires again !!!',"*"); //Infinite loop if this is enabled

});

}

</script>